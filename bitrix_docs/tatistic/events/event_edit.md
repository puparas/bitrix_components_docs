# Загрузка событий

Документация для разработчиков

[Документация для разработчиков](https://dev.1c-bitrix.ru/api_help/)
[Документация по D7](https://dev.1c-bitrix.ru/api_d7/)
[Документация по REST](https://dev.1c-bitrix.ru/rest_help/)
[Пользовательская документация](https://dev.1c-bitrix.ru/user_help/)

Темная тема

[Основные сведения](/user_help/index.php)
[Реализация и системные требования](/user_help/reqintro.php)

[Справочная система и документация](/user_help/help/index.php)

[Контент](/user_help/content/index.php)

[Сайты 24](/user_help/sites24/index.php)

[Маркетинг](/user_help/marketing/index.php)

[Магазин](/user_help/store/index.php)

[Клиенты](/user_help/clients/index.php)

[Сервисы](/user_help/service/index.php)

[Веб-аналитика](/user_help/statistic/index.php)

[Веб-аналитика. Настройки модуля](/user_help/statistic/settings_va.php)
[Сводная статистика](/user_help/statistic/stat_list.php)
[Кто на сайте](/user_help/statistic/users_online.php)

[Посещаемость](/user_help/statistic/site_traffic/index.php)

[Рекламные кампании](/user_help/statistic/advertising_campaigns/index.php)

[События](/user_help/statistic/events/index.php)

[События](/user_help/statistic/events/event_list.php)
[Загрузка событий](/user_help/statistic/events/event_edit.php)

[Типы событий](/user_help/statistic/events/type/index.php)

[Поисковики](/user_help/statistic/search_engines/index.php)

[Ссылающиеся сайты](/user_help/statistic/referer_sites/index.php)

[Посетители](/user_help/statistic/visitors/index.php)

[Marketplace](/user_help/marketplace/index.php)

[Настройки](/user_help/settings/index.php)

[Компоненты](/user_help/components/index.php)

[Описание компонентов решений](/user_help/description_decisions/index.php)

[Дополнительно](/user_help/additional/index.php)

[Веб-аналитика](/user_help/statistic/index.php)

[События](/user_help/statistic/events/index.php)

Загрузка событий

**Недоступно в редакциях:**Малый бизнес, Стандарт, Старт

# Загрузка событий

Форма **Загрузка событий** (*Аналитика > События > Загрузка событий*) предназначена для занесения в базу данных событий, произошедших вне сайта. Примерами таких событий могут служить **оплата заказа**, **отмена заказа** и т.п.

  

### Закладка Загрузка из файла

| Поле | Описание |
| --- | --- |
| CSV файл | Указывается CSV файл со списком событий. Формат данных в файле должен иметь следующие поля: ``` "[1]","[2]","[3]","[4]","[5]","[6]","[7]" ```   1. ID типа события. 2. Дополнительный параметр (**event3**). 3. Дата, заданная в формате даты для текущего сайта. 4. Дополнительный параметр в формате:     ```    BITRIX_SM.сессия.посетитель.страна.рекламная_кампания.возврат.сайт    ``` 5. Денежная сумма события. 6. **[пустое\_поле]** - поле заполнять не нужно, оно используется для совместимости **CSV** файлов с продуктом **"1C-Битрикс: Управление сайтом"** . 7. Возврат денег (**Y** / **N**). Если эта опция установлена, сумма отнимается от доходов рекламной кампании. В противном случае, доход рекламной кампании увеличивается на эту сумму |
| Обработчик CSV файла | Выбирается обработчик **CSV** файла. |
 Предварительный просмотр | При установленной опции будет доступен предварительный просмотр событий ,загружаемых из файла, перед загрузкой на сайт. После нажатия кнопки **Загрузить** происходит чтение файла и занесение полей в таблицу, расположенную на закладке ["Ручной ввод"](#manual). || Загрузить только уникальные события | При установленной опции будет происходить проверка уникальности событий по комбинации всех загружаемых полей (кроме денежной суммы). |
| Шаг загрузки (сек.) | Задается длительность одного шага загрузки данных из **CSV** файла в секундах. При значении **"0"** загрузка данных выполняется за один шаг. |

  
  
**Пример содержания файла CSV:**
  
  

```

10,"file1.exe","10.10.2007 12:30","BITRIX_SM.10.5.RU.6.Y","250"
11,"help_doc.chm","10.10.2007 12:30"
12,"www","10.10.2007 12:30","BITRIX_SM.11.4.US.8.N","233.45"
13,"1C-Битрикс: Корпоративный портал","10.10.2007 12:30","BITRIX_SM.11.4.US.8.N","233.45",,"Y"

```

### Ручной ввод

Таблица служит для ручного ввода событий в базу данных.

| # | ID типа события\* | event3 | Дата | Доп. параметр | Денежная сумма | Возврат денег |  |
| --- | --- | --- | --- | --- | --- | --- | --- |
| [1] | [2] [3] | [4] | [5] [6] | [7] | [8] | [9] | [10] |

1. Порядковый номер.
2. ID типа события.
3. Иконка, вызывающая форму для выбора типа события.
4. Дополнительный параметр события – **event3** (в нем может быть, например, сумма заказа).
5. Дата события.
6. Кнопка, открывающая календарь.
7. Дополнительный параметр (формат описан выше).
8. Денежная сумма события.
9. Если эта опция установлена, сумма отнимается от доходов рекламной кампании. В противном случае, доход рекламной кампании увеличивается на эту сумму.
10. Кнопка, копирующая текущую строку в следующую.

\* - поле, обязательное для заполнения.

### Автоматическая регистрация событий

Когда посетитель уходит, например, на оформление заказа, то в ссылку, ведущую на внешнюю платежную систему, должен быть добавлен специальный шаблон – **`#EVENT_GID#`**.
Этот шаблон в дальнейшем будет автоматически заменен (в скрипте **`redirect.php`**) на составной идентификатор:

```

[код сайта].[ID сессии].[ID посетителя].[ID страны].[ID
 рекламной кампании].[Y – возврат по рекламной кампании; N – прямой заход].
```

Пример такой ссылки:

```

<a href="http://www.ritlabs.ru/redirect.php?event1=softkey_out&
 event2=thebat&event3=buy&
 goto=http://www.softkey.ru/catalog/basket.php?
 prodid=902&quantity=1&referer1=ritlabs_site&referer2=#EVENT_GID#">
Купить
</a>
```

В приведенной ссылке кодированные символы заменены для удобства чтения. Оригинал ссылки:

```

<a href="http://www.ritlabs.ru/redirect.php?event1=softkey_out&
 event2=thebat&event3=buy&
 goto=http%3A//www.softkey.ru/catalog/basket.php%3Fprodid%3D902%26quantity%3D1%26referer1%3Dritlabs_site%26referer2%3D%23EVENT_GID%23">
Купить
</a>
```

Для задания подобных ссылок предусмотрены специальные возможности во встроенном в систему HTML-редакторе.

Большинство платежных систем принимают такой специальный параметр и возвращают его в письме, оповещающем владельца товара о заказе (например, на [www.softkey.ru](/user_help/index.php) таких идентификаторов два:
 *referer1* и *referer2*). Когда к Вам поступает письмо, оповещающее о том, что заказ оформлен, Вы должны занести данное событие в статистику своего сайта.

Если Вы хотите автоматически заносить события, произошедшие вне Вашего сайта, то сделать это можно, загружая PHP-страницу, адрес которой формируется по следующей формуле:

```

http://[ВАШСАЙТ]/bitrix/admin/event_edit.php?

        USER_LOGIN=[ЛОГИН]&USER_PASSWORD=[ПАРОЛЬ]&lang=[САЙТ]&
        Login=Y&TYPE=AUTH&AUTH_FORM=Y&
        ARR[]=[N]&LOAD_[N]=Y&EVENT_ID_[N]=[ID типа]&EVENT3_[N]=[EVENT3]&
        DATE_ENTER_[N]=[ДАТА]&PARAM_[N]= [ПАРАМЕТР]]&MONEY_[N]=[ДЕНЕЖНАЯСУММА]&
        CHARGEBACK_[N]=[ФЛАГВОЗВРАТАДЕНЕГ]&
        ARR[]=[N+1]]&LOAD_[N+1]=Y&EVENT_ID_[N+1]=[ID типа]&EVENT3_[N+1]=[EVENT3]&
        DATE_ENTER_[N+1]=[ДАТА]&PARAM_[N+1]= [ПАРАМЕТР]&MONEY_[N+1]=[ДЕНЕЖНАЯСУММА]&
        CHARGEBACK_[N]=[ФЛАГВОЗВРАТАДЕНЕГ]&
...
        ARR[]=[M]&]&LOAD_[M]=Y&EVENT_ID_[M]=[ID типа]&EVENT3_[M]=[EVENT3]&
        DATE_ENTER_[M]=[ДАТА]&PARAM_[M]= [ПАРАМЕТР]&MONEY_[M]=[ДЕНЕЖНАЯСУММА]&
        CHARGEBACK_[N]=[ФЛАГВОЗВРАТАДЕНЕГ]

&check_unique=Y&save=Y
```

В данной формуле:

* **[ВАШСАЙТ]** – адрес сайта;
* **[ЛОГИН]** – логин пользователя, имеющего право *Запись* для модуля статистики;
* **[ПАРОЛЬ]** – пароль вышеописанного пользователя;
* **[САЙТ]** – сайт, в формате которого будет задана дата события (например, `ru`);
* **[****N****], [****N****+1]** – порядковый номер загружаемого события;
* **[****M****]** – количество загружаемых событий;
* **[****ID****типа]** – ID типа загружаемого события;
* **[****EVENT****3]** – дополнительный параметр события;
* **[ДАТА]** – дата события в формате заданного сайта;
* **[ПАРАМЕТР]** – параметр в формате:  
  [Код сайта].[ID сессии].[ID посетителя].[ID страны].[ID рекламной кампании].[*Y* – возврат по рекламной кампании;
   *N* – прямой заход];
* **[****MONEY****]** – денежная сумма события;
* **[****CHARGEBACK****]** – флаг возврата денег:  *Y* – денежную сумму необходимо отнять от доходов рекламной кампании;
   *N* – денежную сумму необходимо прибавить к доходам компании (по умолчанию).
* **check****\_****unique** – для проверки уникальности загружаемых событий значение данного параметра должно быть
  *Y*, в противном случае уникальность проверяться не будет.

  

##### Пример адреса

```

http://www.1c-bitrix.ru/bitrix/admin/event_edit.php?
       USER_LOGIN=admin&USER_PASSWORD=123456&lang=ru&Login=Y&
       TYPE=AUTH&AUTH_FORM=Y&ARR[]=1&LOAD_1=Y&EVENT_ID_1=35&
       EVENT3_1=250&DATE_ENTER_1=10.01.2007&PARAM_1=BITRIX_SM.10345.676.US.3.Y&
       ARR[]=2&LOAD_2=Y&EVENT_ID_2=35&EVENT3_2=340&DATE_ENTER_2=11.01.2007&
       PARAM_2= BITRIX_SM.10400.700.RU.5.N&MONEY_2=970.35&check_unique=Y&save=Y
```

**Внимание:** пример представлен не в кодированном виде. Для корректной работы страницы вам необходимо для значений параметров ссылки применять URL-кодирование (в PHP - функция **urlencode()**).

Новинки документации в соцсетях:

#### Пользовательские комментарииПомните, что Пользовательские комментарии, несмотря на модерацию, не являются официальной документацией. Ответственность за их использование несет сам пользователь. Также Пользовательские комментарии не являются местом для обсуждения функционала. По подобным вопросам обращайтесь на [форумы](http://dev.1c-bitrix.ru/community/forums/group1/).

© «Битрикс», 2001-2025, «1С-Битрикс», 2025

Наверх