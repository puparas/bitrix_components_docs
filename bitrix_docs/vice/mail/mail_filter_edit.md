# Создание и редактирование правила

Документация для разработчиков

[Документация для разработчиков](https://dev.1c-bitrix.ru/api_help/)
[Документация по D7](https://dev.1c-bitrix.ru/api_d7/)
[Документация по REST](https://dev.1c-bitrix.ru/rest_help/)
[Пользовательская документация](https://dev.1c-bitrix.ru/user_help/)

Темная тема

[Основные сведения](/user_help/index.php)
[Реализация и системные требования](/user_help/reqintro.php)

[Справочная система и документация](/user_help/help/index.php)

[Контент](/user_help/content/index.php)

[Сайты 24](/user_help/sites24/index.php)

[Маркетинг](/user_help/marketing/index.php)

[Магазин](/user_help/store/index.php)

[Клиенты](/user_help/clients/index.php)

[Сервисы](/user_help/service/index.php)

[Бизнес-процессы](/user_help/service/bizproc/index.php)

[Блоги](/user_help/service/blogs/index.php)

[Веб-мессенджер](/user_help/service/im/index.php)

[Веб-формы](/user_help/service/form/index.php)

[Видеоконференциии (КП)](/user_help/service/video/index.php)

[Внешние источники данных (КП)](/user_help/service/xdi/index.php)

[Интранет (КП)](/user_help/service/intranet/index.php)

[Календарь событий](/user_help/service/event_calendar/index.php)

[Конструктор отчетов (КП)](/user_help/service/report/index.php)

[Экстранет (КП)](/user_help/service/extranet/index.php)

[Контроллер](/user_help/service/controller/index.php)

[Менеджер идей](/user_help/service/idea/index.php)

[Опросы, голосования](/user_help/service/vote/index.php)

[Обучение](/user_help/service/learning/index.php)

[Подписка, рассылки](/user_help/service/subscribe/index.php)

[Почта](/user_help/service/mail/index.php)

[Почта. Настройки модуля](/user_help/service/mail/settings.php)
[Почтовые ящики](/user_help/service/mail/mail_mailbox_admin.php)
[Создание и редактирование почтового ящика](/user_help/service/mail/mail_mailbox_edit.php)
[Правила](/user_help/service/mail/mail_filter_admin.php)
[Создание и редактирование правила](/user_help/service/mail/mail_filter_edit.php)
[Журнал работы](/user_help/service/mail/mail_log.php)
[Письма](/user_help/service/mail/mail_message_admin.php)
[Просмотр сообщения](/user_help/service/mail/mail_message_view.php)
[Почтовые сервисы](/user_help/service/mail/mail_services.php)
[Создание и редактирование почтового сервиса](/user_help/service/mail/mail_service_edit.php)

[Рейтинги](/user_help/service/rating/index.php)

[Смайлы](/user_help/service/smile/index.php)

[Социальная сеть (КП)](/user_help/service/socialnetwork/index.php)

[Социальные сервисы](/user_help/service/socialservices/index.php)

[Стикеры](/user_help/service/stickers/index.php)

[Техподдержка](/user_help/service/support/index.php)

[Учет рабочего времени (КП)](/user_help/service/timeman/index.php)

[Форум](/user_help/service/forum/index.php)

[CRM (КП)](/user_help/service/crm/index.php)

[Веб-аналитика](/user_help/statistic/index.php)

[Marketplace](/user_help/marketplace/index.php)

[Настройки](/user_help/settings/index.php)

[Компоненты](/user_help/components/index.php)

[Описание компонентов решений](/user_help/description_decisions/index.php)

[Дополнительно](/user_help/additional/index.php)

[Сервисы](/user_help/service/index.php)

[Почта](/user_help/service/mail/index.php)

Создание и редактирование правила

**Недоступно в редакциях:**Малый бизнес, Стандарт, Старт

# Создание и редактирование правила

### Закладка Параметры

| Поле | Описание |
| --- | --- |
| Код | Код правила, под которым оно было сохранено.    Отображается при редактировании существующего правила. |
| Последнее изменение | Дата и время последнего изменения правила.    Отображается при редактировании существующего правила. |
| Почтовый ящик | Почтовый ящик, к которому должно применяться это правило. Для создания нового почтового ящика, вы можете кликнуть ссылку **Создать**. |
| Активность | Если этот флаг установлен, правило активно и может быть применено к сообщениям.   Если флаг не установлен, правило не применяется к сообщениям.     См. тж. поле **Применять при событиях**. |
| \* Название | Любое осмысленное название данного правила. |
| Описание | Произвольное описание правила. |
| Сортировка | Вес сортировки правила; применяется при отображении правила в списке. |
| Применять при событиях | Типы событий, при которых следует применять это правило:  * **При получении почты** - если флаг установлен, правило будет применяться к каждому сообщению при получении почты с почтового ящика, для которого создано это правило. Если флаг сброшен, правило не будет автоматически применяться при получении почты; * **При принудительном вызове правила** - если флаг установлен, правило можно будет применить в ручном режиме. |

\* - поля, обязательные для заполнения.

### Закладка Условия

| Поле | Описание |
| --- | --- |
| Группы полей для задания условий | Задание условий предварительной фильтрации сообщений перед тем как к ним будет применено данное правило.     Для получения подробной информации по полям группы см. [примечания](#notes) ниже. |
| Вероятность, что сообщение спам | Правило будет применяться только к сообщениям, параметр **СПАМ коэф.** которых удовлетворяет этому условию; т.е. больше или меньше уровня, задаваемого в процентах.     Например, если выставить данное условие в **"больше 90%"**, то правило будет применяться только к тем сообщениям, вероятность спама которых превышает 90%. |
| Размер сообщения | Правило будет применяться только к сообщениям, размер которых удовлетворяет этому условию. |
| Условие на PHP скрипте | Опциональный PHP скрипт, который исполняется во время определения возможности применения правила к сообщению. PHP скрипт должен определить допустимость применения правила к сообщению и вернуть значение **true** или **false**.     Для получения подробной информации об этом поле см. [примечания](#notes) ниже. |
| Настройки добавления сообщения в техподдержку   Эта группа настроек отображается только при создании правила с шаблоном "Добавление сообщения в техподдержку" | |
| Определять по E-Mail ранее зарегистрированного пользователя | Если это условие установлено в **да...**, то при получении нового сообщения правило будет предпринимать попытки найти зарегистрированного пользователя с таким адресом в базе данных и привязать сообщение к нему.   В противном случае, при получении писем с любых адресов сообщения в модуле техподдержки будут создаваться как анонимные. |
| Добавлять новое сообщение в уже открытое обращение | Условие определяет, сообщения с какого адреса могут быть добавлены в открытое обращение в техподдержку.     При установке флага **как скрытое...** сообщение будет доступно только сотрудникам техподдержки. |
| Шаблоны темы для определения ответа на обращение | Регулярные выражения, применяемые для сортировки входящих сообщений. Поле предназначено для разработчиков; не рекомендуется изменять его значение без надобности. |
| Привязывать новое обращение к сайту | Указание на сайт, к которому будет привязано вновь создаваемое обращение. |
| Привязывать новое обращение к категории | Указание категории обращения, к которой будет привязано вновь создаваемое обращение. |
| Назначить новому обращению критичность | Позволяет указать критичность вновь создаваемого обращения. |

### Закладка Действия

| Поле | Описание |
| --- | --- |
| Установить статус прочтенности | Позволяет отметить все сообщения, к которым будет применяться это правило, как прочитанные. |
| Установить пометку спам | Позволяет отметить все сообщения, к которым будет применяться это правило, как сообщения массовой рассылки. |
| Действие на PHP скрипте | Опциональный PHP скрипт, который исполняется во время применения правила к сообщению. |
| Удалить сообщение | Удаляет сообщения, к которым применяется правило. |
| Не обрабатывать другими правилами | Указывает, что после применения этого правила к конкретному сообщению, остальные правила не будут применены к нему, даже если сообщение удовлетворяет условиям правила. |

### Группы полей для задания условий

![](/upload/user_help/service/mail/mail_rule.png)

Первый выпадающий список группы содержит перечень текстовых свойств сообщения, которые являются источником информации для фильтра (**операнд**).

Второй выпадающий список содержит перечень **компаративных операторов** (операторов сравнения), определяющих тип операции сравнения, применяемой к тексту свойства, выбранного в первом списке при фильтрации. В качестве функционального оператора может быть выбран пункт **Регулярное выражение**. Синтаксис используемых регулярных выражений соответствует спецификации **PCRE**. Описание синтаксиса можно найти здесь: <http://ru2.php.net/manual/en/reference.pcre.pattern.syntax.php>.

Поле ввода текста предназначено для ввода **образца текста**, с которым производится сравнение текста свойства первого списка.

  

### Пример

Для того чтобы правило применялось ко всем входящим сообщениям, в поле **Тема** которых присутствует слово "Заказ", установите следующие значения полей:

* **Операнд** - Тема*;*
* **Оператор** - Содержит*;*
* **Образец** - Заказ.

### Пример условия на PHP скрипте

Поставляемые возможности в большинстве случаев достаточны для задания условий отбора сообщений. Однако, если стандартные механизмы не позволяют реализовать требуемые условия отбора сообщений, предусмотрена возможность создания пользовательских программных условий отбора. Скрипт для отбора сообщений должен быть написан на языке PHP. Во время выполнения условного скрипта гарантируется валидность массива полей сообщения **$arMessageFields**.

Условный PHP-скрипт должен вернуть **true**, если условие выполняется и к сообщению может быть применено правило, или **false** в противном случае.

  

### Пример

```
if ($arMessageFields["FIELD_PRIORITY"] > 3 || strpos($arMessageFields["FIELD_FROM"], "@bitrix") > 0)  
   return true;  
return false;  

```

Новинки документации в соцсетях:

#### Пользовательские комментарииПомните, что Пользовательские комментарии, несмотря на модерацию, не являются официальной документацией. Ответственность за их использование несет сам пользователь. Также Пользовательские комментарии не являются местом для обсуждения функционала. По подобным вопросам обращайтесь на [форумы](http://dev.1c-bitrix.ru/community/forums/group1/).

© «Битрикс», 2001-2025, «1С-Битрикс», 2025

Наверх